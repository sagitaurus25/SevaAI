<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SevaAI - Enterprise AWS Agent Squad</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .agent-status {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .agent-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 5px;
            text-align: center;
            min-width: 150px;
            border-left: 4px solid #3498db;
        }
        
        .agent-card.active {
            border-left-color: #2ecc71;
            background: #e8f5e8;
        }
        
        #chatbox { 
            height: 500px; 
            border: 2px solid #e1e8ed; 
            padding: 20px; 
            overflow-y: auto; 
            margin-bottom: 20px; 
            border-radius: 10px;
            background: #fafbfc;
        }
        
        .message {
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            max-width: 80%;
        }
        
        .user-msg { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
        }
        
        .bot-msg { 
            background: #f1f3f4;
            border-left: 4px solid #4285f4;
        }
        
        .agent-info {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .command-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .input-area {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        #input { 
            flex: 1;
            padding: 15px; 
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
        }
        
        #input:focus {
            border-color: #4285f4;
        }
        
        button { 
            padding: 15px 30px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            border: none; 
            border-radius: 25px;
            cursor: pointer; 
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        .examples {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .example-queries {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .example-query {
            background: white;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid #e1e8ed;
            transition: all 0.3s ease;
        }
        
        .example-query:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
        }
        
        .loading {
            display: none;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ¤– SevaAI Agent Squad</h1>
            <p class="subtitle">Enterprise AWS Operations Assistant</p>
        </div>
        
        <div class="agent-status">
            <div class="agent-card" id="s3-agent">
                <strong>S3 Agent</strong><br>
                <small>Storage Operations</small>
            </div>
            <div class="agent-card" id="ec2-agent">
                <strong>EC2 Agent</strong><br>
                <small>Compute Management</small>
            </div>
            <div class="agent-card" id="lambda-agent">
                <strong>Lambda Agent</strong><br>
                <small>Serverless Functions</small>
            </div>
            <div class="agent-card" id="iam-agent">
                <strong>IAM Agent</strong><br>
                <small>Security & Access</small>
            </div>
            <div class="agent-card" id="monitoring-agent">
                <strong>Monitoring Agent</strong><br>
                <small>CloudWatch & Logs</small>
            </div>
        </div>
        
        <div id="chatbox"></div>
        
        <div class="input-area">
            <input type="text" id="input" placeholder="Ask about AWS operations... (e.g., 'List my S3 buckets' or 'Show running EC2 instances')" />
            <button onclick="sendMessage()">Send</button>
        </div>
        
        <div class="examples">
            <h3>ðŸš€ Try These Example Queries:</h3>
            <div class="example-queries">
                <div class="example-query" onclick="setQuery(this.textContent)">
                    List all objects in my-bucket recursively
                </div>
                <div class="example-query" onclick="setQuery(this.textContent)">
                    Show me all running EC2 instances
                </div>
                <div class="example-query" onclick="setQuery(this.textContent)">
                    List my Python Lambda functions
                </div>
                <div class="example-query" onclick="setQuery(this.textContent)">
                    Create a new S3 bucket called my-new-bucket
                </div>
                <div class="example-query" onclick="setQuery(this.textContent)">
                    Show CloudWatch alarms that are triggered
                </div>
                <div class="example-query" onclick="setQuery(this.textContent)">
                    Help me troubleshoot Lambda function errors
                </div>
            </div>
        </div>
    </div>

    <script>
        const chatbox = document.getElementById('chatbox');
        const input = document.getElementById('input');
        
        // Agent name mapping
        const agentMapping = {
            'S3Agent': 's3-agent',
            'EC2Agent': 'ec2-agent', 
            'LambdaAgent': 'lambda-agent',
            'IAMAgent': 'iam-agent',
            'MonitoringAgent': 'monitoring-agent'
        };
        
        // Add initial welcome message
        addBotMessage("ðŸ‘‹ Welcome to SevaAI Agent Squad! I'm your intelligent AWS operations assistant powered by specialized AI agents. Each agent is an expert in specific AWS services and can help you with operations, troubleshooting, and best practices.", "System");
        
        function setQuery(query) {
            input.value = query;
            input.focus();
        }
        
        function highlightActiveAgent(agentName) {
            // Reset all agents
            Object.values(agentMapping).forEach(id => {
                document.getElementById(id).classList.remove('active');
            });
            
            // Highlight active agent
            if (agentMapping[agentName]) {
                document.getElementById(agentMapping[agentName]).classList.add('active');
            }
        }
        
        function addUserMessage(text) {
            const div = document.createElement('div');
            div.className = 'message user-msg';
            div.textContent = text;
            chatbox.appendChild(div);
            chatbox.scrollTop = chatbox.scrollHeight;
        }
        
        function addBotMessage(text, agentName = null) {
            const div = document.createElement('div');
            div.className = 'message bot-msg';
            
            let html = '';
            if (agentName && agentName !== 'System') {
                html += `<div class="agent-info">ðŸ¤– ${agentName} Agent</div>`;
                highlightActiveAgent(agentName);
            }
            
            // Parse markdown-style code blocks
            if (text.includes('```')) {
                const parts = text.split(/```(\w*)\n?/);
                let processedText = '';
                
                for (let i = 0; i < parts.length; i++) {
                    if (i % 3 === 0) {
                        processedText += parts[i];
                    } else if (i % 3 === 2) {
                        processedText += `<div class="command-block">${parts[i]}</div>`;
                    }
                }
                html += processedText;
            } else {
                html += text.replace(/\n/g, '<br>');
            }
            
            div.innerHTML = html;
            chatbox.appendChild(div);
            chatbox.scrollTop = chatbox.scrollHeight;
        }
        
        function showLoading() {
            const div = document.createElement('div');
            div.className = 'message bot-msg loading';
            div.innerHTML = '<div class="agent-info">ðŸ”„ Processing...</div>Analyzing your request and routing to the appropriate agent...';
            div.id = 'loading-message';
            chatbox.appendChild(div);
            chatbox.scrollTop = chatbox.scrollHeight;
        }
        
        function hideLoading() {
            const loadingMsg = document.getElementById('loading-message');
            if (loadingMsg) {
                loadingMsg.remove();
            }
        }
        
        async function sendMessage() {
            const text = input.value.trim();
            if (!text) return;
            
            addUserMessage(text);
            input.value = '';
            showLoading();
            
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: [{ role: 'user', content: text }]
                    }),
                });
                
                hideLoading();
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Extract agent name and content
                const agentName = data.agent_used || data.agent_name || 'System';
                let content = data.content || data.description || 'No response generated';
                
                // Add command if available
                if (data.command && data.command !== '# Processed by ' + agentName) {
                    content += `\n\n**Generated Command:**\n\`\`\`bash\n${data.command}\n\`\`\``;
                }
                
                addBotMessage(content, agentName);
                
            } catch (error) {
                hideLoading();
                addBotMessage(`Sorry, there was an error processing your request: ${error.message}`, 'System');
                console.error('Error:', error);
            }
        }
        
        // Allow pressing Enter to send message
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Auto-focus input
        input.focus();
    </script>
</body>
</html>